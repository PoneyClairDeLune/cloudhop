"use strict";(()=>{var h=["http:","https:","ws:","wss:"],c=function(e,r=0){let o=e-r;return Math.floor(Math.random()*o)+r};String.prototype.test=function(...e){let r=this,o=!1;return e.forEach(function(n){r.indexOf(n)>-1&&(o=!0)}),o};Array.prototype.random=function(){return this[c(this.length)]};var u=function(){return`${c(256,1)}.${c(256,1)}.${c(256,1)}.${c(256,1)}`};var g=async function(e,r,o){let n={};e.headers.forEach(function(d,i){let a=r(i,d);n[a[0]]=a[1]});let t=e.body,l=e.headers.get("Content-Type")?.toLowerCase(),s=!1;return(l?.indexOf("html")>-1||l?.indexOf("css")>-1)&&(s=!0),self.ADAPT_BODY=="1"&&s?(t=await e.text(),t=t.replaceAll(o.from,o.to),n["CloudHop-AdaptBody"]="1"):n["CloudHop-AdaptBody"]="0",new Response(t,{status:e.status,headers:n})},w=function(e,r="noBracket"){let o=e?.toLowerCase(),n=o?.indexOf("mobile")>0,t=o?.test("firefox"),l=o?.test("chrom","safari");switch(r){case"asIs":return e;case"noBracket":{let s=e.indexOf("Mozilla/5.0 (");if(s>-1){let d=e.indexOf(")"),i=o.test("iphone","ipad","ios")?2:o.test("android","mobile")?1:0,a="";return i?i==2?a="iPhone; CPU iPhone OS 14_4 like Mac OS X":a=t?"Android 12; Mobile; rv:91.0":"Linux; Android 12; Pixel 5":a="Windows NT 10.0; Win64; x64",e.slice(0,s+13)+a+e.slice(d)}else return"Dalvik/2.1.0";break}case"mimic":{let s="Mozilla/5.0 (";if(t)s+=n?"Android 12; Mobile; rv:91.0) Gecko/91.0":"Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101",s+=" Firefox/91.0";else if(l)s+=n?"Linux; Android 12; Pixel 5":"Windows NT 10.0; Win64; x64",s+=") AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 ",s+=n?"Mobile ":"",s+="Safari/537.36";else return"Dalvik/2.1.0 (Linux; Android 12; Pixel 5)";return s}default:return r?.toString()||"Dalvik/"}},A=BACKENDS.split(","),C=function(e){return new Response(`<!DOCTYPE html><head><meta charset="utf-8"/><title>Worker exception thrown.</title><style>body{background:#000;color:#ddd;}pre{color:#d00;}</style></head><body><p>Server encountered an error. Details are show below:</p><pre>${e.stack||e}</pre>`,{status:500,headers:{"Alt-Server":"Cloud Hop","Content-Type":"text/html"}})},x=function(e,r){e.respondWith(C(r))},k=async function(e){let r=new URL(e.url),o=A.random();r.hostname=o;let n=h.indexOf(r.protocol);if(n>-1){switch(self.FORCE_IN_TLS){case"plain":{if(n%2==1)return new Response("Using HTTPS on HTTP server.",{status:400,headers:{"Alt-Server":"Cloud Hop","Content-Type":"text/plain"}});break}case"tls":{if(n%2==0)return new Response("Using HTTP on HTTPS server.",{status:400,headers:{"Alt-Server":"Cloud Hop","Content-Type":"text/plain"}});break}}switch(self.FORCE_OUT_TLS){case"tls":{r.protocol=h[(n>>1<<1)+1]||r.protocol;break}case"plain":{r.protocol=h[n>>1<<1]||r.protocol;break}}}let t=new Request(r.toString(),e),l=u(),s=r.protocol.replace(":",""),d=e.headers.get("CF-Workers")||"workers.dev";if(e.headers.has("Host")&&(d=e.headers.get("Host")),e.headers.has("Origin")?t.headers.set("Origin",`${r.protocol}//${o}/`):t.headers.delete("Origin"),e.headers.has("Referer")){let a=new URL(e.headers.get("Referer"));t.headers.set("Referer",`${r.protocol}//${o}${a.pathname}`)}else t.headers.delete("Referer");(self.FULL_INFO||"0")!="1"&&e.headers.has("Accept-Language")&&t.headers.set("Accept-Language",e.headers.get("Accept-Language").split(",")[0]),t.headers.set("X-Real-IP",l),t.headers.set("X-Forwarded-For",`${l}:${c(65536,1024)}`),t.headers.set("X-Forwarded-Proto",s),t.headers.set("CF-Connecting-IP",l),t.headers.set("Cf-Ew-Via","0"),t.headers.set("Cf-Ray","${genSegv6()}${genSegv6()}${genSegv6()}${genSegv6()}-FRA"),t.headers.set("Cf-Visitor",`{"scheme":"${s}"}`),t.headers.set("Mod-Rewrite","Off"),t.headers.set("X-Hcl-Forwarded-Port",s=="https"?"443":"80"),t.headers.set("X-Hcl-Forwarded-Proto",s),t.headers.set("X-Scheme","https"),t.headers.set("User-Agent",w(e.headers.get("User-Agent")||"Dalvik/2.1.0 (Linux; Android 12; Pixel 5)",self.MASK_UA));let i=await fetch(r,t);if(i.status>=300&&i.status<400){let a="";return i.headers.forEach(function(f,p){a+=`${p}: ${f}
`}),new Response(`Remote responded with ${i.status}. Headers:
${a}`,{status:502})}return i?.headers?.has("Content-Security-Policy")?await g(i,function(a,f){return a.toLowerCase()=="content-security-policy"&&(f=f.replaceAll(o,d)),[a,f]},{from:o,to:d}):i};addEventListener("fetch",function(e){try{e.respondWith(k(e.request))}catch(r){x(e,r)}});})();
//# sourceMappingURL=cloudflare.js.map
